From 4ef3c3fc43f4969c3bf8d027cd33a9e84c75d594 Mon Sep 17 00:00:00 2001
From: vgdn1942 <vgdn1942@gmail.com>
Date: Sat, 6 Nov 2021 06:44:28 +0300
Subject: [PATCH] Fix build GAPPS on A12

---
 apps/CarrierServices/Android.mk           |  1 +
 apps/GmsCore/Android.mk                   |  7 +++++++
 apps/GoogleContactsSyncAdapter/Android.mk |  1 +
 apps/GoogleServicesFramework/Android.mk   |  1 +
 apps/Phonesky/Android.mk                  |  1 +
 apps/SearchLauncher/Android.mk            | 12 ++++++------
 apps/SetupWizard/Android.mk               |  1 +
 apps/Velvet/Android.mk                    |  1 +
 8 files changed, 19 insertions(+), 6 deletions(-)

diff --git a/apps/CarrierServices/Android.mk b/apps/CarrierServices/Android.mk
index 52ffdb4..6d82275 100644
--- a/apps/CarrierServices/Android.mk
+++ b/apps/CarrierServices/Android.mk
@@ -17,5 +17,6 @@ LOCAL_CERTIFICATE := PRESIGNED
 LOCAL_SRC_FILES := $(LOCAL_MODULE)_$(my_src_arch).apk
 #LOCAL_OVERRIDES_PACKAGES :=
 #LOCAL_REQUIRED_MODULES :=
+LOCAL_OPTIONAL_USES_LIBRARIES := org.apache.http.legacy
 LOCAL_MODULE_TARGET_ARCH := $(my_src_arch)
 include $(BUILD_PREBUILT)
diff --git a/apps/GmsCore/Android.mk b/apps/GmsCore/Android.mk
index 15202d6..381d407 100644
--- a/apps/GmsCore/Android.mk
+++ b/apps/GmsCore/Android.mk
@@ -24,6 +24,13 @@ endif
 LOCAL_SRC_FILES := $(LOCAL_MODULE)_$(my_src_arch).apk
 LOCAL_OVERRIDES_PACKAGES := NetworkRecommendation
 #LOCAL_REQUIRED_MODULES :=
+LOCAL_OPTIONAL_USES_LIBRARIES := \
+            org.apache.http.legacy \
+            com.android.media.remotedisplay \
+            com.android.location.provider \
+            com.google.android.ble \
+            samsung.uwb \
+            com.google.android.wearable
 ifeq ($(my_src_arch),arm64)
 LOCAL_MULTILIB := both
 else ifeq ($(my_src_arch),x86_64)
diff --git a/apps/GoogleContactsSyncAdapter/Android.mk b/apps/GoogleContactsSyncAdapter/Android.mk
index a57e47d..f1e6f19 100644
--- a/apps/GoogleContactsSyncAdapter/Android.mk
+++ b/apps/GoogleContactsSyncAdapter/Android.mk
@@ -14,4 +14,5 @@ LOCAL_CERTIFICATE := PRESIGNED
 LOCAL_SRC_FILES := $(LOCAL_MODULE).apk
 #LOCAL_OVERRIDES_PACKAGES :=
 #LOCAL_REQUIRED_MODULES :=
+LOCAL_OPTIONAL_USES_LIBRARIES := org.apache.http.legacy
 include $(BUILD_PREBUILT)
diff --git a/apps/GoogleServicesFramework/Android.mk b/apps/GoogleServicesFramework/Android.mk
index 689abee..c6f0fee 100644
--- a/apps/GoogleServicesFramework/Android.mk
+++ b/apps/GoogleServicesFramework/Android.mk
@@ -14,4 +14,5 @@ LOCAL_CERTIFICATE := PRESIGNED
 LOCAL_SRC_FILES := $(LOCAL_MODULE)_default.apk
 #LOCAL_OVERRIDES_PACKAGES :=
 #LOCAL_REQUIRED_MODULES :=
+LOCAL_OPTIONAL_USES_LIBRARIES := org.apache.http.legacy
 include $(BUILD_PREBUILT)
diff --git a/apps/Phonesky/Android.mk b/apps/Phonesky/Android.mk
index e300501..eb91ff1 100644
--- a/apps/Phonesky/Android.mk
+++ b/apps/Phonesky/Android.mk
@@ -14,5 +14,6 @@ LOCAL_CERTIFICATE := PRESIGNED
 LOCAL_SRC_FILES := $(LOCAL_MODULE).apk
 #LOCAL_OVERRIDES_PACKAGES :=
 #LOCAL_REQUIRED_MODULES :=
+LOCAL_OPTIONAL_USES_LIBRARIES := org.apache.http.legacy
 LOCAL_MODULE_TARGET_ARCH := arm x86 x86_64
 include $(BUILD_PREBUILT)
diff --git a/apps/SearchLauncher/Android.mk b/apps/SearchLauncher/Android.mk
index 0b7f7d4..b0b632a 100644
--- a/apps/SearchLauncher/Android.mk
+++ b/apps/SearchLauncher/Android.mk
@@ -23,7 +23,7 @@ LOCAL_USE_AAPT2 := true
 LOCAL_AAPT2_ONLY := true
 
 # Relative path for AOSP Launcher3 directory
-LAUNCHER_PATH := ../../../../packages/apps/Launcher3
+LAUNCHER_PATH := ../../../../packages/apps/Trebuchet
 
 LOCAL_STATIC_ANDROID_LIBRARIES := Launcher3CommonDepsLib
 LOCAL_STATIC_JAVA_LIBRARIES := lib_launcherClient
@@ -60,7 +60,7 @@ LOCAL_USE_AAPT2 := true
 LOCAL_AAPT2_ONLY := true
 
 # Relative path for AOSP Launcher3 directory
-LAUNCHER_PATH := ../../../../packages/apps/Launcher3
+LAUNCHER_PATH := ../../../../packages/apps/Trebuchet
 
 LOCAL_STATIC_ANDROID_LIBRARIES := Launcher3CommonDepsLib
 LOCAL_STATIC_JAVA_LIBRARIES := \
@@ -74,14 +74,14 @@ LOCAL_SRC_FILES := \
     $(call all-java-files-under, $(LAUNCHER_PATH)/quickstep/src) \
     $(call all-java-files-under, $(LAUNCHER_PATH)/src_shortcuts_overrides) \
     $(call all-java-files-under, src) \
-    $(call all-java-files-under, $(LAUNCHER_PATH)/src) \
-    $(call all-java-files-under, $(LAUNCHER_PATH)/quickstep/recents_ui_overrides/src)
+    $(call all-java-files-under, $(LAUNCHER_PATH)/src)
+    #$(call all-java-files-under, $(LAUNCHER_PATH)/quickstep/recents_ui_overrides/src)
 
 LOCAL_RESOURCE_DIR := \
     $(LOCAL_PATH)/quickstep/res \
     $(LOCAL_PATH)/res \
-    $(LOCAL_PATH)/$(LAUNCHER_PATH)/quickstep/res \
-    $(LOCAL_PATH)/$(LAUNCHER_PATH)/quickstep/recents_ui_overrides/res
+    $(LOCAL_PATH)/$(LAUNCHER_PATH)/quickstep/res
+    #$(LOCAL_PATH)/$(LAUNCHER_PATH)/quickstep/recents_ui_overrides/res
 
 LOCAL_PROGUARD_ENABLED := disabled
 LOCAL_PRIVATE_PLATFORM_APIS := true
diff --git a/apps/SetupWizard/Android.mk b/apps/SetupWizard/Android.mk
index 9fb2c74..db6928b 100644
--- a/apps/SetupWizard/Android.mk
+++ b/apps/SetupWizard/Android.mk
@@ -17,6 +17,7 @@ LOCAL_CERTIFICATE := PRESIGNED
 LOCAL_SRC_FILES := $(LOCAL_MODULE)_$(my_src_arch).apk
 LOCAL_OVERRIDES_PACKAGES := Provision
 #LOCAL_REQUIRED_MODULES :=
+LOCAL_OPTIONAL_USES_LIBRARIES := org.apache.http.legacy
 LOCAL_MODULE_TARGET_ARCH := $(my_src_arch)
 include $(BUILD_PREBUILT)
 
diff --git a/apps/Velvet/Android.mk b/apps/Velvet/Android.mk
index 4102422..426ff2b 100644
--- a/apps/Velvet/Android.mk
+++ b/apps/Velvet/Android.mk
@@ -38,5 +38,6 @@ endif
 LOCAL_SRC_FILES := $(LOCAL_MODULE)_$(my_src_arch).apk
 LOCAL_OVERRIDES_PACKAGES := QuickSearchBox
 LOCAL_REQUIRED_MODULES := GmsConfigOverlayGSA $(OFFLINE_LANG_PACK_FILE_LIST)
+LOCAL_OPTIONAL_USES_LIBRARIES := org.apache.http.legacy
 LOCAL_MODULE_TARGET_ARCH := $(my_src_arch)
 include $(BUILD_PREBUILT)
-- 
2.20.1

