From bd665ec053def65b54d3dfce52afd9b85ff0e485 Mon Sep 17 00:00:00 2001
From: vgdn1942 <vgdn1942@gmail.com>
Date: Fri, 16 Jul 2021 18:27:21 +0300
Subject: [PATCH] Cleanup GMS overlay

---
 .../res/values/config.xml                     |  5 ---
 ...allowed_personal_apps_org_owned_device.xml |  3 --
 .../res/values/vendor_cross_profile_apps.xml  | 11 -------
 .../vendor_required_apps_managed_device.xml   |  3 --
 .../vendor_required_apps_managed_profile.xml  |  2 --
 .../vendor_required_apps_managed_user.xml     |  3 --
 .../res/values/config.xml                     |  2 ++
 .../apps/Settings/res/values/config.xml       | 32 -------------------
 products/gms.mk                               |  3 +-
 products/google_comms_suite.mk                |  2 +-
 10 files changed, 5 insertions(+), 61 deletions(-)
 delete mode 100644 overlay/GmsConfigOverlayCommon/res/values/vendor_cross_profile_apps.xml
 delete mode 100644 overlay/gms_overlay/packages/apps/Settings/res/values/config.xml

diff --git a/overlay/GmsConfigOverlayCommon/res/values/config.xml b/overlay/GmsConfigOverlayCommon/res/values/config.xml
index b55e913..a007c6e 100644
--- a/overlay/GmsConfigOverlayCommon/res/values/config.xml
+++ b/overlay/GmsConfigOverlayCommon/res/values/config.xml
@@ -32,9 +32,6 @@
     <!-- The package name of the default network recommendation app. -->
     <string name="config_defaultNetworkRecommendationProviderPackage" translatable="false">com.google.android.gms</string>
 
-    <!-- Default service to enable with accessibility shortcut [DO NOT TRANSLATE] -->
-    <string name="config_defaultAccessibilityService" translatable="false">com.google.android.marvin.talkback/.TalkBackService</string>
-
     <!-- Colon separated list of package names that should be granted Notification Listener access -->
     <string name="config_defaultListenerAccessPackages" translatable="false">com.android.launcher3:com.google.android.projection.gearhead</string>
 
@@ -61,12 +58,10 @@
     <string-array name="config_nonBlockableNotificationPackages" translatable="false">
         <item>com.google.android.setupwizard</item>
         <item>com.google.android.apps.restore</item>
-        <item>com.google.android.dialer</item>
     </string-array>
 
     <!-- An array of packages that can make sound on the ringer stream in priority-only DND mode -->
     <string-array name="config_priorityOnlyDndExemptPackages" translatable="false">
-        <item>com.google.android.dialer</item>
         <item>android</item>
         <item>com.android.systemui</item>
     </string-array>
diff --git a/overlay/GmsConfigOverlayCommon/res/values/vendor_allowed_personal_apps_org_owned_device.xml b/overlay/GmsConfigOverlayCommon/res/values/vendor_allowed_personal_apps_org_owned_device.xml
index f9bc5a5..8654dbc 100644
--- a/overlay/GmsConfigOverlayCommon/res/values/vendor_allowed_personal_apps_org_owned_device.xml
+++ b/overlay/GmsConfigOverlayCommon/res/values/vendor_allowed_personal_apps_org_owned_device.xml
@@ -4,10 +4,7 @@
     <string-array translatable="false" name="vendor_allowed_personal_apps_org_owned_device">
         <item>com.android.vending</item> <!-- Google Play -->
         <item>com.google.android.gms</item> <!-- Required by Play -->
-        <item>com.google.android.contacts</item> <!-- Google Contacts -->
         <item>com.google.android.apps.wellbeing</item> <!-- Digital Wellbeing -->
-        <item>com.google.android.googlequicksearchbox</item> <!-- package that contains Google Launcher -->
-        <item>com.google.android.dialer</item> <!-- Google dialer to enable making phone calls -->
         <item>com.google.android.apps.messaging</item> <!-- Google Messenger for SMS -->
         <item>com.google.android.setupwizard</item> <!-- Google SetupWizard to finish DO provisioning properly -->
     </string-array>
diff --git a/overlay/GmsConfigOverlayCommon/res/values/vendor_cross_profile_apps.xml b/overlay/GmsConfigOverlayCommon/res/values/vendor_cross_profile_apps.xml
deleted file mode 100644
index 3fa928a..0000000
--- a/overlay/GmsConfigOverlayCommon/res/values/vendor_cross_profile_apps.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<resources>
-    <!--
-    A collection of apps that have been pre-approved for cross-profile communication.
-    These will not require admin consent, but will still require user consent during provisioning.
-    -->
-    <string-array translatable="false" name="vendor_cross_profile_apps">
-        <item>com.google.android.googlequicksearchbox</item> <!-- Google -->
-        <item>com.google.android.inputmethod.latin</item> <!-- Gboard -->
-    </string-array>
-</resources>
diff --git a/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_device.xml b/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_device.xml
index c4af335..28e9440 100644
--- a/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_device.xml
+++ b/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_device.xml
@@ -4,10 +4,7 @@
     <string-array name="vendor_required_apps_managed_device" translatable="false">
         <item>com.android.vending</item> <!-- Google Play -->
         <item>com.google.android.gms</item> <!-- Required by Play -->
-        <item>com.google.android.contacts</item> <!-- Google Contacts -->
         <item>com.google.android.apps.wellbeing</item> <!-- Digital Wellbeing -->
-        <item>com.google.android.googlequicksearchbox</item> <!-- package that contains Google Launcher -->
-        <item>com.google.android.dialer</item> <!-- Google dialer to enable making phone calls -->
         <item>com.google.android.apps.messaging</item> <!-- Google Messenger for SMS -->
         <item>com.google.android.setupwizard</item> <!-- Google SetupWizard to finish DO provisioning properly -->
     </string-array>
diff --git a/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_profile.xml b/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_profile.xml
index 7b83173..d745686 100644
--- a/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_profile.xml
+++ b/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_profile.xml
@@ -4,8 +4,6 @@
     <string-array name="vendor_required_apps_managed_profile" translatable="false">
         <item>com.android.vending</item> <!-- Google Play -->
         <item>com.google.android.gms</item> <!-- Required by Play -->
-        <item>com.google.android.contacts</item> <!-- Google Contacts -->
         <item>com.google.android.apps.wellbeing</item> <!-- Digital Wellbeing -->
-        <item>com.google.android.googlequicksearchbox</item> <!-- Google -->
     </string-array>
 </resources>
diff --git a/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_user.xml b/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_user.xml
index 19a32af..5cd6e2d 100644
--- a/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_user.xml
+++ b/overlay/GmsConfigOverlayCommon/res/values/vendor_required_apps_managed_user.xml
@@ -5,10 +5,7 @@
     <string-array name="vendor_required_apps_managed_user" translatable="false">
         <item>com.android.vending</item> <!-- Google Play -->
         <item>com.google.android.gms</item> <!-- Required by Play -->
-        <item>com.google.android.contacts</item> <!-- Google Contacts -->
         <item>com.google.android.apps.wellbeing</item> <!-- Digital Wellbeing -->
-        <item>com.google.android.googlequicksearchbox</item> <!-- Google Launcher -->
-        <item>com.google.android.dialer</item> <!-- Google dialer to enable making phone calls -->
         <item>com.google.android.apps.messaging</item> <!-- Google Messenger for SMS -->
     </string-array>
 </resources>
diff --git a/overlay/GmsConfigOverlayComms/res/values/config.xml b/overlay/GmsConfigOverlayComms/res/values/config.xml
index bbe56ee..47071ed 100644
--- a/overlay/GmsConfigOverlayComms/res/values/config.xml
+++ b/overlay/GmsConfigOverlayComms/res/values/config.xml
@@ -1,7 +1,9 @@
 <?xml version="1.0" encoding="utf-8"?>
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
     <!-- The name of the package that will hold the dialer role by default. -->
+    <!--
     <string name="config_defaultDialer" translatable="false">com.google.android.dialer</string>
+    -->
 
     <!-- The name of the package that will hold the SMS role by default. -->
     <string name="config_defaultSms" translatable="false">com.google.android.apps.messaging</string>
diff --git a/overlay/gms_overlay/packages/apps/Settings/res/values/config.xml b/overlay/gms_overlay/packages/apps/Settings/res/values/config.xml
deleted file mode 100644
index 5c6686a..0000000
--- a/overlay/gms_overlay/packages/apps/Settings/res/values/config.xml
+++ /dev/null
@@ -1,32 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-/*
-* Copyright (C) 2017 The Android Open Source Project
-*
-* Licensed under the Apache License, Version 2.0 (the "License");
-* you may not use this file except in compliance with the License.
-* You may obtain a copy of the License at
-*
-*      http://www.apache.org/licenses/LICENSE-2.0
-*
-* Unless required by applicable law or agreed to in writing, software
-* distributed under the License is distributed on an "AS IS" BASIS,
-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-* See the License for the specific language governing permissions and
-* limitations under the License.
-*/
--->
-<resources xmlns:android="http://schemas.android.com/apk/res/android"
-           xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <!-- List containing the component names of pre-installed screen reader services [DO NOT TRANSLATE] -->
-    <string-array name="config_preinstalled_screen_reader_services" translatable="false">
-        <item>com.google.android.marvin.talkback/com.google.android.marvin.talkback.TalkBackService</item>
-        <item>com.google.android.marvin.talkback/com.google.android.accessibility.selecttospeak.SelectToSpeakService</item>
-    </string-array>
-
-    <!-- List containing the component names of pre-installed interaction control services [DO NOT TRANSLATE] -->
-    <string-array name="config_preinstalled_interaction_control_services" translatable="false">
-        <item>com.google.android.marvin.talkback/com.android.switchaccess.SwitchAccessService</item>
-        <item>com.google.android.marvin.talkback/com.google.android.accessibility.accessibilitymenu.AccessibilityMenuService</item>
-    </string-array>
-</resources>
diff --git a/products/gms.mk b/products/gms.mk
index 10e9ed9..f6c3e82 100644
--- a/products/gms.mk
+++ b/products/gms.mk
@@ -45,11 +45,12 @@ PRODUCT_PACKAGES += \
     privapp_permissions_google_product \
     privapp_permissions_google_system_ext \
     split_permissions_google \
-    preferred_apps_google \
     sysconfig_google \
     sysconfig_wellbeing \
     google_hiddenapi_package_allowlist
 
+#    preferred_apps_google \
+
 # Overlay for GMS devices: default backup transport in SettingsProvider
 PRODUCT_PACKAGE_OVERLAYS += $(ANDROID_PARTNER_GMS_HOME)/overlay/gms_overlay
 
diff --git a/products/google_comms_suite.mk b/products/google_comms_suite.mk
index 3cd5d2e..c604533 100644
--- a/products/google_comms_suite.mk
+++ b/products/google_comms_suite.mk
@@ -1,4 +1,4 @@
-PRODUCT_PACKAGE_OVERLAYS += vendor/partner_gms/overlay/gms_overlay_comms
+#PRODUCT_PACKAGE_OVERLAYS += vendor/partner_gms/overlay/gms_overlay_comms
 
 PRODUCT_PACKAGES += \
     privapp_permissions_google_comms_suite \
-- 
2.20.1

