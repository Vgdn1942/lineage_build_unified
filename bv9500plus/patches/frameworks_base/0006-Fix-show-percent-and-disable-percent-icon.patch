From b5a50395860c8941b8e4e89872c923c909fc685d Mon Sep 17 00:00:00 2001
From: vgdn1942 <vgdn1942@gmail.com>
Date: Sat, 8 Jan 2022 22:24:00 +0300
Subject: [PATCH] Fix show percent and disable percent icon

Change-Id: I62236ed38bfe932bbd1362cc3d27f86195e84eae
---
 .../src/com/android/systemui/BatteryMeterView.java    | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java b/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
index 08028dfc8367..74c85a4b9ed2 100644
--- a/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
+++ b/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
@@ -70,6 +70,7 @@ import java.io.FileDescriptor;
 import java.io.PrintWriter;
 import java.lang.annotation.Retention;
 import java.text.NumberFormat;
+import java.util.Locale;
 
 public class BatteryMeterView extends LinearLayout implements
         BatteryStateChangeCallback, Tunable, DarkReceiver, ConfigurationListener {
@@ -378,8 +379,14 @@ public class BatteryMeterView extends LinearLayout implements
         if (mBatteryPercentView == null) {
             return;
         }
-        mBatteryPercentView.setText(
-                NumberFormat.getPercentInstance().format(mLevel / 100f));
+        if (LineageSettings.System.getIntForUser(
+                getContext().getContentResolver(), STATUS_BAR_SHOW_BATTERY_PERCENT, 0, mUser) != 0) {
+            mBatteryPercentView.setText(
+                    NumberFormat.getPercentInstance(Locale.US).format(mLevel / 100f));
+        } else {
+            mBatteryPercentView.setText(
+                    NumberFormat.getNumberInstance().format(mLevel));
+        }
         setContentDescription(
                 getContext().getString(mCharging ? R.string.accessibility_battery_level_charging
                         : R.string.accessibility_battery_level, mLevel));
-- 
2.20.1

